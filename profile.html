<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChillPick | Home</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="css/profile1.css">
  <link rel="stylesheet" href="css/app.css">
</head>
<body>

  <div id="header"></div>

  <main class="container py-5">

  <!-- Success Popup Modal -->
  <div class="custom-modal" id="successModal">
    <div class="custom-modal-content">
      <i class="bi bi-check-circle" style="color: rgb(56, 207, 56); font-size: 80px;"></i>
      <h5 class="mb-3">Updated Successfully!</h5>
      <button class="btn btn-warning" id="closeModalBtn">OK</button>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="changePasswordForm">
            <div class="mb-3">
              <label for="currentPassword" class="form-label">Current Password*</label>
              <div class="input-group">
                <input type="password" class="form-control" id="currentPassword" required>
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="currentPassword">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              <div class="invalid-feedback" id="currentPasswordFeedback"></div>
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password*</label>
              <div class="input-group">
                <input type="password" class="form-control" id="newPassword" required>
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="newPassword">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              <div class="invalid-feedback" id="newPasswordFeedback"></div>
              <small class="form-text text-muted">
                Password must be at least 8 characters with:
                <ul class="ps-3 mb-0">
                  <li>1 uppercase letter</li>
                  <li>1 lowercase letter</li>
                  <li>1 digit</li>
                  <li>Cannot be same as current password</li>
                </ul>
              </small>
            </div>
            <div class="mb-3">
              <label for="confirmPassword" class="form-label">Confirm New Password*</label>
              <div class="input-group">
                <input type="password" class="form-control" id="confirmPassword" required>
                <button class="btn btn-outline-secondary toggle-password" type="button" data-target="confirmPassword">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              <div class="invalid-feedback" id="confirmPasswordFeedback"></div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-warning" id="savePasswordBtn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

   <!-- Verify Password Modal -->
<div class="modal fade" id="verifyPasswordModal" tabindex="-1" aria-labelledby="verifyPasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="verifyPasswordModalLabel">Verify Your Identity</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p class="text-danger mb-3" id="verifyPasswordError" style="display: none;"></p>
        <p>For security, please enter your current password to continue with account deletion.</p>
        <div class="mb-3">
          <label for="verifyPassword" class="form-label">Current Password*</label>
          <div class="input-group">
            <input type="password" class="form-control" id="verifyPassword" required>
            <button class="btn btn-outline-secondary toggle-password" type="button" data-target="verifyPassword">
              <i class="bi bi-eye-slash"></i>
            </button>
          </div>
          <div class="invalid-feedback" id="verifyPasswordFeedback"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="verifyPasswordBtn">Continue</button>
      </div>
    </div>
  </div>
</div>

  <!-- Delete Account Modal -->
  <div class="custom-modal" id="deleteAccountModal">
    <div class="custom-modal-content">
      <h4 class="text-center mb-3">Are you sure you want to delete your account?</h4>
      <p class="text-center mb-4" style="color: #6c757d;">
        This process cannot be undone. </p>

      <div class="form-check mb-4">
        <input class="form-check-input" type="checkbox" id="confirmDeleteCheckbox">
        <label class="form-check-label" for="confirmDeleteCheckbox">
          I understand this will delete all my data permanently.
        </label>
      </div>

      <div class="modal-buttons">
        <button id="noDeleteAccountModalBtn" class="btn btn-outline-secondary" style="width: 100px;">No</button>
        <button id="deleteAccountModalBtn" class="btn btn-warning" style="width: 100px;" disabled>Yes</button>
      </div>
    </div>
  </div>


  <!--content start here-->
  <div class="container profile-container">
    <h2 id="welcomeMessage" style="margin: 30px auto;">Welcome back</h2>
    <div class="row">
      <!-- Left Sidebar -->
      <div class="col-md-4 mb-3">
        <div class="profile-sidebar text-center">
          <img src="images/profile_pic.png" alt="Profile Picture" class="profile-pic" id="profilePicture">
          <h3 id="profileName">Bonie Rawles</h3>
          <h6 class="text-muted" id="profileEmail">bonie04@gmail.com</h6>

          <button class="btn btn-outline-warning btn-sm mt-2 mb-4" id="uploadPicBtn">
            <i class="bi bi-upload"></i> Upload Profile Picture
          </button>

          <div class="text-start">
            <h5 class="section-title text-center">About</h5>
            <div class="bio-section">
              <div id="bioDisplay" class="d-flex justify-content-between align-items-center">
                <p id="bioText" class="bio-placeholder mb-0">Add your bio...</p>
                <button id="editBioBtn" class="btn btn-link p-0 ms-2">
                  <i class="bi bi-pencil-square" style="color: var(--orange);"></i>
                </button>
              </div>
              <div id="bioEdit" class="d-none">
                <textarea id="bioInput" class="form-control mb-2" rows="3"></textarea>
                <div class="d-flex justify-content-end gap-2">
                  <button id="cancelBioBtn" class="btn btn-sm btn-outline-secondary">Cancel</button>
                  <button id="saveBioBtn" class="btn btn-sm btn-outline-warning">Save</button>
                </div>
              </div>
            </div>
          </div>

          <div class="text-end mt-4">
            <button class="btn btn-outline-danger logout-btn" id="logoutBtn">
              <i class="bi bi-box-arrow-right"></i> Log Out
            </button>
          </div>
        </div>
      </div>

      <!-- Right Content -->
      <div class="col-md-8">
        <div class="profile-content">
          <h3 class="section-title" style="font-size: 2rem; ">Personal Details</h3>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label" style="font-size: 1.1rem;">Username*</label>
                <input type="text" class="form-control form-control-lg" id="usernameField" readonly>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label" style="font-size: 1.1rem;">Email*</label>
                <input type="email" class="form-control form-control-lg" id="emailField" readonly>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label" style="font-size: 1.1rem;">Phone No*</label>
                <input type="tel" class="form-control form-control-lg" id="phoneField">
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label" style="font-size: 1.1rem;">Gender</label>
                <select class="form-control form-control-lg" id="genderField">
                  <option value="" selected disabled>Please select your gender</option>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Other">Other</option>
                </select>
              </div>
            </div>
          </div>

          <div class="d-flex gap-3 mt-4">
            <button class="btn btn-warning" id="changePasswordBtn">Change Password</button>
            <button class="btn btn-outline-warning" id="editBtn">Edit</button>
            <button class="btn btn-outline-danger" id="deleteAccountBtn">Delete account</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Picture Upload Modal -->
  <div class="modal fade" id="uploadPicModal" tabindex="-1" aria-labelledby="uploadPicModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadPicModalLabel">Upload Profile Picture</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-3">
            <img id="imagePreview" src="images/profile_pic.png" alt="Preview" class="img-fluid rounded-circle"
              style="width: 200px; height: 200px; object-fit: cover;">
          </div>
          <div class="mb-3">
            <input type="file" class="form-control" id="profileImageInput" accept="image/*">
            <small class="text-muted">Recommended size: 200x200 pixels</small>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-warning" id="saveProfilePicBtn">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Session Expiring Soon Modal -->
  <div class="modal fade" id="sessionExpiringModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 text-center">
        <i class="bi bi-clock-history text-warning fs-1 mb-3"></i>
        <h4 class="fw-bold">Session Expiring Soon</h4>
        <p>You've been inactive for a while. For security, you'll be logged out in <span id="countdown">1:00</span>.</p>
        <div class="d-flex justify-content-center gap-2">
          <button id="stayLoggedInBtn" class="btn btn-warning">Stay Logged In</button>
          <button id="logoutNowBtn" class="btn btn-outline-secondary">Log Out Now</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Session Expired Modal -->
  <div class="modal fade" id="sessionExpiredModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static"
    data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 text-center">
        <i class="bi bi-alarm-fill text-danger fs-1 mb-3"></i>
        <h4 class="fw-bold">Session Expired</h4>
        <p>For your security, you've been logged out due to inactivity.</p>
        <button id="loginAgainBtn" class="btn btn-warning">Log In Again</button>
      </div>
    </div>
  </div>

</main>

<div id="footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/load-partials.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Get current user from localStorage
      const currentUserEmail = localStorage.getItem('currentUser');
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const currentUser = users.find(user => user.email === currentUserEmail);

      if (!currentUser) {
        alert('Please login first');
        window.location.href = 'login.html';
        return;
      }

      // Load user data
      document.getElementById('welcomeMessage').textContent = `Welcome back, ${currentUser.username}`;
      document.getElementById('profileName').textContent = currentUser.username;
      document.getElementById('profileEmail').textContent = currentUser.email;
      document.getElementById('usernameField').value = currentUser.username;
      document.getElementById('emailField').value = currentUser.email;
      document.getElementById('phoneField').value = currentUser.phone || '';


      // And add this profile data loading section
      const profileData = JSON.parse(localStorage.getItem(`profile_${currentUser.email}`)) || {};
      if (profileData.gender) {
        document.getElementById('genderField').value = profileData.gender;
      }
      if (profileData.bio) {
        document.getElementById('bioText').textContent = profileData.bio;
        document.getElementById('bioText').classList.remove('bio-placeholder');
      }
      if (profileData.phone) {
        document.getElementById('phoneField').value = profileData.phone;
      }

      // Modal functionality
      const successModal = document.getElementById('successModal');
      const closeModalBtn = document.getElementById('closeModalBtn');

      function showSuccessModal() {
        successModal.classList.add('show');
      }

      function hideSuccessModal() {
        successModal.classList.remove('show');
      }

      closeModalBtn.addEventListener('click', hideSuccessModal);
      successModal.addEventListener('click', function (e) {
        if (e.target === successModal) hideSuccessModal();
      });

      // Bio Editor
      const bioDisplay = document.getElementById('bioDisplay');
      const bioEdit = document.getElementById('bioEdit');
      const bioText = document.getElementById('bioText');
      const bioInput = document.getElementById('bioInput');

      document.getElementById('editBioBtn').addEventListener('click', function () {
        bioDisplay.classList.add('d-none');
        bioEdit.classList.remove('d-none');
        bioInput.value = bioText.classList.contains('bio-placeholder') ? '' : bioText.textContent;
        bioInput.focus();
      });

      document.getElementById('saveBioBtn').addEventListener('click', function () {
        const newBio = bioInput.value.trim();
        if (newBio) {
          bioText.textContent = newBio;
          bioText.classList.remove('bio-placeholder');
        } else {
          bioText.textContent = 'Add your bio...';
          bioText.classList.add('bio-placeholder');
        }

        // Save to profile data
        const profileData = JSON.parse(localStorage.getItem(`profile_${currentUser.email}`)) || {};
        profileData.bio = newBio || null;
        localStorage.setItem(`profile_${currentUser.email}`, JSON.stringify(profileData));

        bioDisplay.classList.remove('d-none');
        bioEdit.classList.add('d-none');
        showSuccessModal();
      });

      document.getElementById('cancelBioBtn').addEventListener('click', function () {
        bioDisplay.classList.remove('d-none');
        bioEdit.classList.add('d-none');
      });

      // Edit/Save toggle
      const editBtn = document.getElementById('editBtn');
      editBtn.addEventListener('click', function () {
        const isEditMode = this.textContent === 'Edit';

        document.querySelectorAll('.form-control').forEach(input => {
          if (input.id !== 'emailField' && input.id !== 'usernameField') {
            input.readOnly = !isEditMode;
          }
        });

        document.getElementById('genderField').disabled = !isEditMode;

        if (isEditMode) {
          this.textContent = 'Save';
          this.classList.remove('btn-outline-orange');
          this.classList.add('btn-orange');
        } else {
          this.textContent = 'Edit';
          this.classList.add('btn-outline-orange');
          this.classList.remove('btn-orange');

          // Save profile data
          const profileData = JSON.parse(localStorage.getItem(`profile_${currentUser.email}`)) || {};
          profileData.phone = document.getElementById('phoneField').value.trim();
          profileData.gender = document.getElementById('genderField').value;
          localStorage.setItem(`profile_${currentUser.email}`, JSON.stringify(profileData));

          showSuccessModal();
        }
      });

      // Change Password Functionality
      const changePasswordModal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
      const changePasswordForm = document.getElementById('changePasswordForm');
      const currentPasswordInput = document.getElementById('currentPassword');
      const newPasswordInput = document.getElementById('newPassword');
      const confirmPasswordInput = document.getElementById('confirmPassword');

      // Toggle password visibility
      document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function () {
          const targetId = this.getAttribute('data-target');
          const input = document.getElementById(targetId);
          const icon = this.querySelector('i');

          if (input.type === 'password') {
            input.type = 'text';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
          } else {
            input.type = 'password';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
          }
        });
      });

      document.getElementById('changePasswordBtn').addEventListener('click', function () {
        changePasswordModal.show();
        changePasswordForm.reset();

        // Reset all fields and validation states
        [currentPasswordInput, newPasswordInput, confirmPasswordInput].forEach(input => {
          input.type = 'password';
          input.classList.remove('is-invalid');
          const icon = document.querySelector(`.toggle-password[data-target="${input.id}"] i`);
          if (icon) {
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
          }
        });

        // Clear any error messages
        document.querySelectorAll('.invalid-feedback').forEach(el => {
          el.textContent = '';
        });
      });

      document.getElementById('savePasswordBtn').addEventListener('click', function () {
        // Reset validation states
        [currentPasswordInput, newPasswordInput, confirmPasswordInput].forEach(input => {
          input.classList.remove('is-invalid');
          const feedback = document.getElementById(`${input.id}Feedback`);
          if (feedback) feedback.style.display = 'none';
        });

        // Get values
        const currentPassword = currentPasswordInput.value.trim();
        const newPassword = newPasswordInput.value.trim();
        const confirmPassword = confirmPasswordInput.value.trim();

        let isValid = true;

        // Validate current password
        if (!currentPassword) {
          currentPasswordInput.classList.add('is-invalid');
          document.getElementById('currentPasswordFeedback').style.display = 'block';
          document.getElementById('currentPasswordFeedback').textContent = 'Current password is required';
          isValid = false;
        } else if (currentUser.password !== currentPassword) {
          currentPasswordInput.classList.add('is-invalid');
          document.getElementById('currentPasswordFeedback').style.display = 'block';
          document.getElementById('currentPasswordFeedback').textContent = 'Current password is incorrect';
          isValid = false;
        }

        // Validate new password
        if (!newPassword) {
          newPasswordInput.classList.add('is-invalid');
          document.getElementById('newPasswordFeedback').style.display = 'block';
          document.getElementById('newPasswordFeedback').textContent = 'New password is required';
          isValid = false;
        } else if (newPassword.length < 8) {
          newPasswordInput.classList.add('is-invalid');
          document.getElementById('newPasswordFeedback').style.display = 'block';
          document.getElementById('newPasswordFeedback').textContent = 'Password must be at least 8 characters';
          isValid = false;
        } else if (!/[A-Z]/.test(newPassword)) {
          newPasswordInput.classList.add('is-invalid');
          document.getElementById('newPasswordFeedback').style.display = 'block';
          document.getElementById('newPasswordFeedback').textContent = 'Password must contain at least 1 uppercase letter';
          isValid = false;
        } else if (!/[a-z]/.test(newPassword)) {
          newPasswordInput.classList.add('is-invalid');
          document.getElementById('newPasswordFeedback').style.display = 'block';
          document.getElementById('newPasswordFeedback').textContent = 'Password must contain at least 1 lowercase letter';
          isValid = false;
        } else if (!/[0-9]/.test(newPassword)) {
          newPasswordInput.classList.add('is-invalid');
          document.getElementById('newPasswordFeedback').style.display = 'block';
          document.getElementById('newPasswordFeedback').textContent = 'Password must contain at least 1 digit';
          isValid = false;
        } else if (newPassword === currentPassword) {
          newPasswordInput.classList.add('is-invalid');
          document.getElementById('newPasswordFeedback').style.display = 'block';
          document.getElementById('newPasswordFeedback').textContent = 'New password must be different from current password';
          isValid = false;
        }

        // Validate confirm password
        if (!confirmPassword) {
          confirmPasswordInput.classList.add('is-invalid');
          document.getElementById('confirmPasswordFeedback').style.display = 'block';
          document.getElementById('confirmPasswordFeedback').textContent = 'Please confirm your new password';
          isValid = false;
        } else if (confirmPassword !== newPassword) {
          confirmPasswordInput.classList.add('is-invalid');
          document.getElementById('confirmPasswordFeedback').style.display = 'block';
          document.getElementById('confirmPasswordFeedback').textContent = 'Passwords do not match';
          isValid = false;
        }

        if (isValid) {
          // Update password in users array
          const users = JSON.parse(localStorage.getItem('users')) || [];
          const userIndex = users.findIndex(user => user.email === currentUser.email);

          if (userIndex !== -1) {
            users[userIndex].password = newPassword;
            localStorage.setItem('users', JSON.stringify(users));

            // Update currentUser in memory
            currentUser.password = newPassword;

            // Show success message and close modal
            changePasswordModal.hide();
            showSuccessModal();
          }
        }

      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', function () {
        if (confirm('Are you sure you want to log out?')) {
          localStorage.removeItem('currentUser');
          localStorage.removeItem('currentSession');
          localStorage.removeItem('activeSessions');
          window.location.href = 'login.html';
        }
      });


    });

  </script>

  <script>
document.addEventListener('DOMContentLoaded', function () {
  // Get current user from localStorage
  const currentUserEmail = localStorage.getItem('currentUser');
  const users = JSON.parse(localStorage.getItem('users')) || [];
  const currentUser = users.find(user => user.email === currentUserEmail);

  // Modal elements
  const deleteAccountModal = document.getElementById('deleteAccountModal');
  const verifyPasswordModal = new bootstrap.Modal(document.getElementById('verifyPasswordModal'));
  const verifyPasswordError = document.getElementById('verifyPasswordError');

  // Show verify password modal when delete button is clicked
  document.getElementById('deleteAccountBtn').addEventListener('click', function () {
    // Reset the modal state
    document.getElementById('verifyPassword').value = '';
    document.getElementById('verifyPassword').classList.remove('is-invalid');
    document.getElementById('verifyPasswordFeedback').textContent = '';
    verifyPasswordError.style.display = 'none';
    
    verifyPasswordModal.show();
  });

  // Handle password verification
  document.getElementById('verifyPasswordBtn').addEventListener('click', function () {
    const passwordInput = document.getElementById('verifyPassword');
    const password = passwordInput.value.trim();
    const feedback = document.getElementById('verifyPasswordFeedback');
    
    // Reset validation state
    passwordInput.classList.remove('is-invalid');
    feedback.textContent = '';
    verifyPasswordError.style.display = 'none';
    
    // Validate password
    if (!password) {
      passwordInput.classList.add('is-invalid');
      feedback.textContent = 'Password is required';
      verifyPasswordError.textContent = 'Password is required.';
      verifyPasswordError.style.display = 'block';
      passwordInput.focus();
      return;
    }
    
    // Check if password matches
    if (password !== currentUser.password) {
      verifyPasswordError.textContent = 'Incorrect password. Please try again.';
      verifyPasswordError.style.display = 'block';
      passwordInput.classList.add('is-invalid');
      passwordInput.value = '';
      passwordInput.focus();
      return;
    }
    
    // Password is correct, proceed to delete confirmation
    verifyPasswordModal.hide();
    
    // Reset and show delete confirmation modal
    document.getElementById('confirmDeleteCheckbox').checked = false;
    document.getElementById('deleteAccountModalBtn').disabled = true;
    deleteAccountModal.classList.add('show'); // This line shows the delete confirmation modal
  });

  // Make sure delete confirmation modal is hidden when verify modal is closed via cancel
  verifyPasswordModal._element.addEventListener('hidden.bs.modal', function() {
    // Only hide delete modal if it was shown after verification
    if (!document.getElementById('verifyPassword').value) {
      deleteAccountModal.classList.remove('show');
    }
  });

  // Enable/disable delete button based on checkbox
  document.getElementById('confirmDeleteCheckbox').addEventListener('change', function () {
    document.getElementById('deleteAccountModalBtn').disabled = !this.checked;
  });

  // Close modal when clicking No
  document.getElementById('noDeleteAccountModalBtn').addEventListener('click', function () {
    deleteAccountModal.classList.remove('show');
  });

  // Close modal when clicking outside
  deleteAccountModal.addEventListener('click', function (e) {
    if (e.target === deleteAccountModal) {
      deleteAccountModal.classList.remove('show');
    }
  });

  // Handle account deletion
  document.getElementById('deleteAccountModalBtn').addEventListener('click', function () {
    if (document.getElementById('confirmDeleteCheckbox').checked) {
      // Remove user from users array
      const updatedUsers = users.filter(user => user.email !== currentUser.email);
      localStorage.setItem('users', JSON.stringify(updatedUsers));

      // Remove all user-related data
      localStorage.removeItem('currentUser');
      localStorage.removeItem(`profile_${currentUser.email}`);
      localStorage.removeItem('currentSession');
      localStorage.removeItem('activeSessions');

      // Close modal and redirect
      deleteAccountModal.classList.remove('show');
      window.location.href = 'register.html';
    }
  });





      // Profile Picture Upload Functionality
      const uploadPicModal = new bootstrap.Modal(document.getElementById('uploadPicModal'));
      const profileImageInput = document.getElementById('profileImageInput');
      const imagePreview = document.getElementById('imagePreview');
      const profilePicture = document.getElementById('profilePicture');

      // Open upload modal
      document.getElementById('uploadPicBtn').addEventListener('click', function () {
        // Reset the input and preview
        profileImageInput.value = '';
        imagePreview.src = profilePicture.src;
        uploadPicModal.show();
      });

      // Preview image when file is selected
      profileImageInput.addEventListener('change', function () {
        const file = this.files[0];
        if (file) {
          if (file.size > 2 * 1024 * 1024) { // 2MB limit
            alert('File size should be less than 2MB');
            this.value = '';
            return;
          }

          const reader = new FileReader();
          reader.onload = function (e) {
            imagePreview.src = e.target.result;
          }
          reader.readAsDataURL(file);
        }
      });

      // Save profile picture
      document.getElementById('saveProfilePicBtn').addEventListener('click', function () {
        const file = profileImageInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            // Update profile picture
            profilePicture.src = e.target.result;
            imagePreview.src = e.target.result;

            // Save to localStorage
            const currentUserEmail = localStorage.getItem('currentUser');
            if (currentUserEmail) {
              const profileData = JSON.parse(localStorage.getItem(`profile_${currentUserEmail}`)) || {};
              profileData.profilePicture = e.target.result;
              localStorage.setItem(`profile_${currentUserEmail}`, JSON.stringify(profileData));
            }

            uploadPicModal.hide();
            showSuccessModal();
          }
          reader.readAsDataURL(file);
        } else {
          alert('Please select an image first');
        }
      });

      // Load saved profile picture if exists
      if (currentUserEmail) {
        const profileData = JSON.parse(localStorage.getItem(`profile_${currentUserEmail}`)) || {};
        if (profileData.profilePicture) {
          profilePicture.src = profileData.profilePicture;
        }
      }
    });
  </script>


  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Timeout settings (in milliseconds)
      const TOTAL_SESSION_TIME = 3 * 60 * 1000; // 3 minutes total session
      const WARNING_TIME = 2 * 60 * 1000; // Show warning at 2 minutes (1 minute left)
      const COUNTDOWN_INTERVAL = 1000; // Update every second
      const EXPIRE_DISPLAY_TIME = 10 * 1000; // Show expired message for 10 seconds

      let sessionTimer;
      let warningTimer;
      let countdownInterval;
      let expireTimer;

      // Initialize modals
      const expiringModal = new bootstrap.Modal(document.getElementById('sessionExpiringModal'), {
        backdrop: 'static',
        keyboard: false
      });

      const expiredModal = new bootstrap.Modal(document.getElementById('sessionExpiredModal'), {
        backdrop: 'static',
        keyboard: false
      });

      // Start fresh session
      startSession();

      function startSession() {
        // Clear any existing timers
        resetTimers();

        // Set new timers
        warningTimer = setTimeout(showExpiringWarning, WARNING_TIME);
        sessionTimer = setTimeout(expireSession, TOTAL_SESSION_TIME);

        // Mark session as active in localStorage
        localStorage.setItem('sessionActive', 'true');
      }

      function showExpiringWarning() {
        expiringModal.show();

        // Start 1 minute countdown (60 seconds)
        let secondsLeft = (TOTAL_SESSION_TIME - WARNING_TIME) / 1000;
        updateCountdownDisplay(secondsLeft);

        countdownInterval = setInterval(() => {
          secondsLeft--;
          updateCountdownDisplay(secondsLeft);

          if (secondsLeft <= 0) {
            clearInterval(countdownInterval);
          }
        }, COUNTDOWN_INTERVAL);
      }

      function updateCountdownDisplay(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        document.getElementById('countdown').textContent =
          `${mins}:${secs < 10 ? '0' : ''}${secs}`;
      }

      function expireSession() {
        // Hide warning modal if shown
        expiringModal.hide();
        clearInterval(countdownInterval);

        clearSession();

        // Show expired modal
        expiredModal.show();

        // Auto-redirect after display time
        expireTimer = setTimeout(() => {
          window.location.href = 'login.html';
        }, EXPIRE_DISPLAY_TIME);
      }

      function forceLogout() {
        // Immediate logout without showing expired message
        clearSession();
        expiringModal.hide();
        window.location.href = 'login.html';
      }

      function clearSession() {
        // Remove all session-related data
        localStorage.removeItem('currentUser');
        localStorage.removeItem('currentSession');
        localStorage.removeItem('activeSessions');
        resetTimers();
      }



      function resetTimers() {
        clearTimeout(sessionTimer);
        clearTimeout(warningTimer);
        clearInterval(countdownInterval);
        clearTimeout(expireTimer);
      }

      // Activity detection - reset on any user activity
      const activityEvents = ['mousemove', 'keydown', 'click', 'scroll', 'touchstart'];
      activityEvents.forEach(event => {
        window.addEventListener(event, startSession, { passive: true });
      });

      // Button handlers
      document.getElementById('stayLoggedInBtn').addEventListener('click', function () {
        startSession();
        expiringModal.hide();
      });

      document.getElementById('logoutNowBtn').addEventListener('click', forceLogout);

      document.getElementById('loginAgainBtn').addEventListener('click', function () {
        clearSession();
        window.location.href = 'login.html';
      });
    });
  </script>
</body>

</html>