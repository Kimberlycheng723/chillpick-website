<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width; initial-scale=1.0">
    <title>Movies</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../css/app.css">
    <link rel="stylesheet" href="../../css/detail_page/movie_detail.css">
    <script>
  const currentUser = <%- JSON.stringify(currentUser || null) %>;
  console.log("Current user:", currentUser);
</script>
  </head>

  <body data-movie-id="<%= movie.id || movie.tmdbId %>">
    <%- include('../partials/header') %>

    <main class="container my-5">
      <!-- Media detail section here (unchanged) -->

      <!-- Recommendations section here (unchanged) -->

      <!-- Review Section -->
      <section class="details-section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3><i class="bi bi-chat-left-dots"></i> User Reviews</h3>
<% if (currentUser) { %>
  <button class="btn btn-warning" id="writeReviewBtn">Write a Review</button>
<% } else { %>
  <p>You must log in to rate this item.</p>
<% } %>
        </div>

        <!-- Review Form -->
        <div id="reviewForm" class="card mb-4 p-3 border shadow-sm d-none">
          <h5>Write Your Review</h5>
          <div class="mb-2">
            <div id="ratingInput">
              <i class="bi bi-star-fill" data-value="1"></i>
              <i class="bi bi-star-fill" data-value="2"></i>
              <i class="bi bi-star-fill" data-value="3"></i>
              <i class="bi bi-star-fill" data-value="4"></i>
              <i class="bi bi-star-fill" data-value="5"></i>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="confirmRatingCheck">
              <label class="form-check-label" for="confirmRatingCheck"> Contains Spoilers</label>
            </div>
          </div>
          <div class="mb-2">
            <textarea class="form-control" rows="3" placeholder="Write your review..."></textarea>
          </div>
          <button type="submit" class="btn btn-warning">Submit Review</button>
        </div>

        <!-- Reviews Container -->
        <div id="reviewsContainer"></div>

        <!-- Load More -->
        <div class="text-center mt-4">
          <button class="btn btn-warning load-more-reviews-btn">
            Load More Reviews
          </button>
        </div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../js/detail_page/movie_detail.js"></script>
    <%- include('../partials/footer') %>
  </body>
</html>